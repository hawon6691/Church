import re

# 성경책 매핑 (약어 -> 전체 이름)
book_mapping = {
    '창': '창세기', '출': '출애굽기', '레': '레위기', '민': '민수기', '신': '신명기',
    '수': '여호수아', '삿': '사사기', '룻': '룻기', '삼상': '사무엘상', '삼하': '사무엘하',
    '왕상': '열왕기상', '왕하': '열왕기하', '대상': '역대상', '대하': '역대하', 
    '스': '에스라', '느': '느헤미야', '에': '에스더', '욥': '욥기', '시': '시편',
    '잠': '잠언', '전': '전도서', '아': '아가', '사': '이사야', '렘': '예레미야',
    '애': '예레미아애가', '겔': '에스겔', '단': '다니엘', '호': '호세아', '욜': '요엘',
    '암': '아모스', '옵': '오바댜', '욘': '요나', '미': '미가', '나': '나훔',
    '합': '하박국', '습': '스바냐', '학': '학개', '슥': '스가랴', '말': '말라기',
    '마': '마태복음', '막': '마가복음', '눅': '누가복음', '요': '요한복음', '행': '사도행전',
    '롬': '로마서', '고전': '고린도전서', '고후': '고린도후서', '갈': '갈라디아서',
    '엡': '에베소서', '빌': '빌립보서', '골': '골로새서', '살전': '데살로니가전서',
    '살후': '데살로니가후서', '딤전': '디모데전서', '딤후': '디모데후서', '딛': '디도서',
    '몬': '빌레몬서', '히': '히브리서', '약': '야고보서', '벧전': '베드로전서',
    '벧후': '베드로후서', '요일': '요한일서', '요이': '요한이서', '요삼': '요한삼서',
    '유': '유다서', '계': '요한계시록'
}

# 파일 번호 매핑
book_numbers = {
    '창세기': '1-01', '출애굽기': '1-02', '레위기': '1-03', '민수기': '1-04', '신명기': '1-05',
    '여호수아': '1-06', '사사기': '1-07', '룻기': '1-08', '사무엘상': '1-09', '사무엘하': '1-10',
    '열왕기상': '1-11', '열왕기하': '1-12', '역대상': '1-13', '역대하': '1-14',
    '에스라': '1-15', '느헤미야': '1-16', '에스더': '1-17', '욥기': '1-18', '시편': '1-19',
    '잠언': '1-20', '전도서': '1-21', '아가': '1-22', '이사야': '1-23', '예레미야': '1-24',
    '예레미아애가': '1-25', '에스겔': '1-26', '다니엘': '1-27', '호세아': '1-28', '요엘': '1-29',
    '아모스': '1-30', '오바댜': '1-31', '요나': '1-32', '미가': '1-33', '나훔': '1-34',
    '하박국': '1-35', '스바냐': '1-36', '학개': '1-37', '스가랴': '1-38', '말라기': '1-39',
    '마태복음': '2-01', '마가복음': '2-02', '누가복음': '2-03', '요한복음': '2-04', '사도행전': '2-05',
    '로마서': '2-06', '고린도전서': '2-07', '고린도후서': '2-08', '갈라디아서': '2-09',
    '에베소서': '2-10', '빌립보서': '2-11', '골로새서': '2-12', '데살로니가전서': '2-13',
    '데살로니가후서': '2-14', '디모데전서': '2-15', '디모데후서': '2-16', '디도서': '2-17',
    '빌레몬서': '2-18', '히브리서': '2-19', '야고보서': '2-20', '베드로전서': '2-21',
    '베드로후서': '2-22', '요한일서': '2-23', '요한이서': '2-24', '요한삼서': '2-25',
    '유다서': '2-26', '요한계시록': '2-27'
}

def split_bible_file():
    # bible.txt 읽기
    with open('tx/bible.txt', 'r', encoding='utf-8') as f:
        lines = f.readlines()
    
    # 각 책별로 줄 분류
    book_lines = {}
    for book_abbr in book_mapping.keys():
        book_lines[book_abbr] = []
    
    # 줄 분류
    for line in lines:
        line = line.strip()
        if not line:
            continue
        
        # 책 약어 추출
        match = re.match(r'^([가-힣]+)\d+:\d+', line)
        if match:
            book_abbr = match.group(1)
            if book_abbr in book_mapping:
                book_lines[book_abbr].append(line)
    
    # 각 책별로 파일 생성
    for book_abbr, full_name in book_mapping.items():
        if full_name in book_numbers:
            book_num = book_numbers[full_name]
            filepath = f'tx/{book_num}{full_name}.txt'
            
            if book_lines[book_abbr]:
                # 정렬
                sorted_lines = sorted(book_lines[book_abbr], key=lambda x: (
                    int(re.match(r'^[가-힣]+(\d+):(\d+)', x).group(1)),
                    int(re.match(r'^[가-힣]+(\d+):(\d+)', x).group(2))
                ))
                
                # 파일 저장
                with open(filepath, 'w', encoding='utf-8') as f:
                    for line in sorted_lines:
                        f.write(line + '\n')
                
                print(f'생성 완료: {filepath} ({len(sorted_lines)}개 구절)')
            else:
                print(f'건너뜀: {full_name} (내용 없음)')

if __name__ == '__main__':
    split_bible_file()
    print('\n모든 파일 생성 완료!')
